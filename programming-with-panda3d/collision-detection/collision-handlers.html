

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Collision Handlers &mdash; Panda3D Manual</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Panda3D Manual" href="../../index.html"/>
        <link rel="up" title="Collision Detection" href="index.html"/>
        <link rel="next" title="Collision Entries" href="collision-entries.html"/>
        <link rel="prev" title="Collision Solids" href="collision-solids.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Panda3D
          

          
          </a>

          
            
            
              <div class="version">
                1.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro/index.html">Introduction to Panda3D</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Programming with Panda3D</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../the-scene-graph/index.html">The Scene Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../the-configuration-file/index.html">The Configuration File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models-and-actors/index.html">Models and Actors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../render-attributes/index.html">Render Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../texturing/index.html">Texturing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shaders/index.html">Shaders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../camera-control/index.html">Camera Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/index.html">Sound</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intervals/index.html">Intervals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tasks-and-event-handling/index.html">Tasks and Event Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../text-and-image-rendering/index.html">Text and Image Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../directgui/index.html">DirectGUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../render-effects/index.html">Render Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../finite-state-machines/index.html">Finite State Machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../terrain/index.html">Terrain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internal-structures/index.html">Advanced operations with Panda3D&#8217;s internal structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../render-to-texture-and-image-postprocessing/index.html">Render-to-Texture and Image Postprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../panda3d-rendering-process/index.html">Panda3D Rendering Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../panda3d-utility-functions.html">Panda3D Utility Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../particle-effects/index.html">Particle Effects</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Collision Detection</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="collision-solids.html">Collision Solids</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Collision Handlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="collision-entries.html">Collision Entries</a></li>
<li class="toctree-l3"><a class="reference internal" href="collision-traversers.html">Collision Traversers</a></li>
<li class="toctree-l3"><a class="reference internal" href="collision-bitmasks.html">Collision Bitmasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="rapidly-moving-objects.html">Rapidly-Moving Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="pusher-example.html">Pusher Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="event-example.html">Event Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="bitmask-example.html">Bitmask Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="clicking-on-3d-objects.html">Clicking on 3D Objects</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../garbage-collection/index.html">Garbage Collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware-support/index.html">Hardware support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../math-engine/index.html">Math Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../physics/index.html">Physics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../motion-paths.html">Motion Paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timing/index.html">Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multifiles/index.html">Multifiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../showbase.html">ShowBase</a></li>
<li class="toctree-l2"><a class="reference internal" href="../file-reading.html">File Reading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../threading.html">Threading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subclassing.html">Subclassing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../table-of-features-supported-per-graphic-renderer.html">Table of features supported per graphic renderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pandai/index.html">Artificial Intelligence (PANDAI)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../distribution/index.html">Distributing Panda3D Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/index.html">Sample Programs in the Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance-tuning/index.html">Performance Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../using-c++/index.html">Using C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Panda3D Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building-from-source.html">Building Panda3D from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cheat-sheets.html">Cheat Sheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started-on-osx.html">Getting Started on OSX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../more-panda3d-resources.html">More Panda3D Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../thirdparty-licenses.html">Third-party dependencies and license info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../the-irc-channel.html">The IRC Channel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Panda3D</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Programming with Panda3D</a> &raquo;</li>
      
          <li><a href="index.html">Collision Detection</a> &raquo;</li>
      
    <li>Collision Handlers</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/programming-with-panda3d/collision-detection/collision-handlers.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="collision-handlers">
<span id="id1"></span><h1>Collision Handlers<a class="headerlink" href="#collision-handlers" title="Permalink to this headline">¶</a></h1>
<p>You will need to create a CollisionHandler that specifies what to do when a
collision event is detected. Each object can only have one collision handler
associated with it. There are several possible kinds of CollisionHandler
available.</p>
<div class="section" id="collisionhandlerqueue">
<h2>CollisionHandlerQueue<a class="headerlink" href="#collisionhandlerqueue" title="Permalink to this headline">¶</a></h2>
<p>The simplest kind of CollisionHandler, this object simply records the
collisions that were detected during the most recent traversal. You can then
iterate through the list using
<code class="docutils literal"><span class="pre">queue.getNumEntries()</span></code> and
<code class="docutils literal"><span class="pre">queue.getEntry()</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">queue</span> <span class="o">=</span> <span class="n">CollisionHandlerQueue</span><span class="p">()</span>
<span class="n">traverser</span><span class="o">.</span><span class="n">addCollider</span><span class="p">(</span><span class="n">fromObject</span><span class="p">,</span> <span class="n">queue</span><span class="p">)</span>
<span class="n">traverser</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">render</span><span class="p">)</span>

<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">queue</span><span class="o">.</span><span class="n">getEntries</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">CollisionHandlerQueue</span> <span class="o">*</span><span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CollisionHandlerQueue</span><span class="p">();</span>
<span class="n">CollisionTraverser</span> <span class="n">traverser</span><span class="p">;</span>
<span class="n">traverser</span><span class="p">.</span><span class="n">add_collider</span><span class="p">(</span><span class="n">fromObject</span><span class="p">,</span><span class="n">queue</span><span class="p">);</span>
<span class="n">traverser</span><span class="p">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">get_render</span><span class="p">());</span>

<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">queue</span><span class="o">-&gt;</span><span class="n">get_num_entries</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">CollisionEntry</span> <span class="o">*</span><span class="n">entry</span> <span class="o">=</span> <span class="n">queue</span><span class="o">-&gt;</span><span class="n">get_entry</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">entry</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>By default, the <a class="reference internal" href="collision-entries.html#collision-entries"><span class="std std-ref">Collision Entries</span></a> appear in the queue in no particular
order. You can arrange them in order from nearest to furthest by calling
<code class="docutils literal"><span class="pre">queue.sortEntries()</span></code> after the traversal.</p>
</div>
<div class="section" id="collisionhandlerevent">
<h2>CollisionHandlerEvent<a class="headerlink" href="#collisionhandlerevent" title="Permalink to this headline">¶</a></h2>
<p>This is another simple kind of CollisionHandler. Rather than saving up the
collisions, it generates a <a class="reference internal" href="../tasks-and-event-handling/index.html#tasks-and-event-handling"><span class="std std-ref">Panda event</span></a> when
collision events are detected.</p>
<p>There are three kinds of events that may be generated: the &#8220;in&#8221; event, when a
particular object collides with another object that it didn&#8217;t in the previous
pass, the &#8220;out&#8221; event, when an object is no longer colliding with an object it
collided with in the previous pass, and the &#8220;again&#8221; event, when an object is
still colliding with the same object that it did in the previous pass.</p>
<p>For each kind of event, the CollisionHandlerEvent will construct an event name
out of the names of the from and into objects that were involved in the
collision. The exact event name is controlled by a pattern string that you
specify. For instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">handler</span><span class="o">.</span><span class="n">addInPattern</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">n-into-</span><span class="si">%i</span><span class="s1">n&#39;</span><span class="p">)</span>
<span class="n">handler</span><span class="o">.</span><span class="n">addAgainPattern</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">n-again-</span><span class="si">%i</span><span class="s1">n&#39;</span><span class="p">)</span>
<span class="n">handler</span><span class="o">.</span><span class="n">addOutPattern</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">n-out-</span><span class="si">%i</span><span class="s1">n&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">C_handler</span><span class="p">.</span><span class="n">add_in_pattern</span><span class="p">(</span><span class="s">&quot;%fn-into-%in&quot;</span><span class="p">);</span>
<span class="n">C_handler</span><span class="p">.</span><span class="n">add_again_pattern</span><span class="p">(</span><span class="s">&quot;%fn-into-%in&quot;</span><span class="p">);</span>
<span class="n">C_handler</span><span class="p">.</span><span class="n">add_out_pattern</span><span class="p">(</span><span class="s">&quot;%fn-into-%in&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>In the pattern string, the following sequences have special meaning:</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>%fn</td>
<td>the name of the &#8220;from&#8221; object&#8217;s node</td>
</tr>
<tr class="row-even"><td>%in</td>
<td>the name of the &#8220;into&#8221; object&#8217;s node</td>
</tr>
<tr class="row-odd"><td>%fs</td>
<td>&#8216;t&#8217; if &#8220;from&#8221; is declared to be tangible, &#8216;i&#8217; if intangible</td>
</tr>
<tr class="row-even"><td>%is</td>
<td>&#8216;t&#8217; if &#8220;into&#8221; is declared to be tangible, &#8216;i&#8217; if intangible</td>
</tr>
<tr class="row-odd"><td>%ig</td>
<td>&#8216;c&#8217; if the collision is into a CollisionNode, &#8216;g&#8217; if it is an ordinary visible GeomNode</td>
</tr>
<tr class="row-even"><td>%(tag)fh</td>
<td>generate event only if &#8220;from&#8221; node has the indicated tag</td>
</tr>
<tr class="row-odd"><td>%(tag)fx</td>
<td>generate event only if &#8220;from&#8221; node does not have the indicated tag</td>
</tr>
<tr class="row-even"><td>%(tag)ih</td>
<td>generate event only if &#8220;into&#8221; node has the indicated tag</td>
</tr>
<tr class="row-odd"><td>%(tag)ix</td>
<td>generate event only if &#8220;into&#8221; node does not have the indicated tag</td>
</tr>
<tr class="row-even"><td>%(tag)ft</td>
<td>the indicated tag value of the &#8220;from&#8221; node.</td>
</tr>
<tr class="row-odd"><td>%(tag)it</td>
<td>the indicated tag value of the &#8220;into&#8221; node.</td>
</tr>
</tbody>
</table>
<p>You may use as many of the above sequences as you like, or none, in the
pattern string. In the tag-based sequences, the parentheses around (tag) are
literal; the idea is to write the name of the tag you want to look up,
surrounded by parentheses. The tag is consulted using the
<code class="docutils literal"><span class="pre">nodePath.getNetTag()</span></code> interface.</p>
<p>In any case, the event handler function that you write to service the event
should receive one parameter (in addition to self, if it is a method): the
<a class="reference internal" href="collision-entries.html#collision-entries"><span class="std std-ref">CollisionEntry</span></a>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyObject</span><span class="p">(</span><span class="n">DirectObject</span><span class="o">.</span><span class="n">DirectObject</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">(</span><span class="s1">&#39;car-into-rail&#39;</span><span class="p">,</span> <span class="n">handleRailCollision</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">handleRailCollision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">entry</span>
</pre></div>
</div>
<p>Note that all of the following versions of CollisionHandler also inherit from
CollisionHandlerEvent, so any of them can be set up to throw events in the
same way.</p>
</div>
<div class="section" id="collisionhandlerpusher">
<h2>CollisionHandlerPusher<a class="headerlink" href="#collisionhandlerpusher" title="Permalink to this headline">¶</a></h2>
<p>This is the first of the more sophisticated handlers. The
CollisionHandlerPusher, in addition to inheriting all of the event logic from
CollisionHandlerEvent, will automatically push back on its from object to keep
it out of walls. The visual effect is that your object will simply stop moving
when it reaches a wall if it hits the wall head-on, or it will slide along the
wall smoothly if it strikes the wall at an angle.</p>
<p>The CollisionHandlerPusher needs to have a handle to the NodePath that it will
push back on, for each from object; you pass this information to
<code class="docutils literal"><span class="pre">pusher.addCollider</span></code>. This should be the
node that is actually moving. This is often, but not always, the same NodePath
as the CollisionNode itself, but it might be different if the CollisionNode is
set up as a child of the node that is actually moving.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">smiley</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">loadModel</span><span class="p">(</span><span class="s1">&#39;smiley.egg&#39;</span><span class="p">)</span>
<span class="n">fromObject</span> <span class="o">=</span> <span class="n">smiley</span><span class="o">.</span><span class="n">attachNewNode</span><span class="p">(</span><span class="n">CollisionNode</span><span class="p">(</span><span class="s1">&#39;colNode&#39;</span><span class="p">))</span>
<span class="n">fromObject</span><span class="o">.</span><span class="n">node</span><span class="p">()</span><span class="o">.</span><span class="n">addSolid</span><span class="p">(</span><span class="n">CollisionSphere</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">pusher</span> <span class="o">=</span> <span class="n">CollisionHandlerPusher</span><span class="p">()</span>
<span class="n">pusher</span><span class="o">.</span><span class="n">addCollider</span><span class="p">(</span><span class="n">fromObject</span><span class="p">,</span> <span class="n">smiley</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">smiley</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">load_model</span><span class="p">(</span><span class="n">framework</span><span class="p">.</span><span class="n">get_models</span><span class="p">(),</span><span class="s">&quot;smiley.egg&quot;</span><span class="p">);</span>
<span class="n">fromObject</span> <span class="o">=</span> <span class="n">smiley</span><span class="p">.</span><span class="n">attach_new_node</span><span class="p">(</span><span class="n">CollisionNode</span><span class="p">(</span><span class="s">&quot;colNode&quot;</span><span class="p">));</span>
<span class="n">fromObject</span><span class="o">-&gt;</span><span class="n">add_solid</span><span class="p">(</span><span class="n">CollisionSphere</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>

<span class="n">pusher</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CollisionHandlerPusher</span><span class="p">();</span>
<span class="n">pusher</span><span class="p">.</span><span class="n">add_collider</span><span class="p">(</span><span class="n">fromObject</span><span class="p">,</span><span class="n">smiley</span><span class="p">);</span>
</pre></div>
</div>
<p>Don&#8217;t be confused by the call to
<code class="docutils literal"><span class="pre">pusher.addCollider</span></code>; it looks a lot like
the call to <code class="docutils literal"><span class="pre">traverser.addCollider</span></code>, but it&#8217;s
not the same thing, and you still need to add the collider and its handler to
the traverser:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">traverser</span><span class="o">.</span><span class="n">addCollider</span><span class="p">(</span><span class="n">fromObject</span><span class="p">,</span> <span class="n">pusher</span><span class="p">)</span>
<span class="n">smiley</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">CollisionTraverser</span> <span class="n">traverser</span><span class="p">.</span><span class="n">add_collider</span><span class="p">(</span><span class="n">fromObject</span><span class="p">,</span><span class="n">pusher</span><span class="p">);</span>
<span class="n">smiley</span><span class="o">-&gt;</span><span class="n">set_pos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>If you are using Panda&#8217;s drive mode to move the camera around (or some other
node), then you also need to tell the pusher about the drive node, by adding
it into the <code class="docutils literal"><span class="pre">pusher.addCollider</span></code> call:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">fromObject</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">attachNewNode</span><span class="p">(</span><span class="n">CollisionNode</span><span class="p">(</span><span class="s1">&#39;colNode&#39;</span><span class="p">))</span>
<span class="n">fromObject</span><span class="o">.</span><span class="n">node</span><span class="p">()</span><span class="o">.</span><span class="n">addSolid</span><span class="p">(</span><span class="n">CollisionSphere</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">pusher</span> <span class="o">=</span> <span class="n">CollisionHandlerPusher</span><span class="p">()</span>
<span class="n">pusher</span><span class="o">.</span><span class="n">addCollider</span><span class="p">(</span><span class="n">fromObject</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">camera</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">drive</span><span class="o">.</span><span class="n">node</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">fromObject</span> <span class="o">=</span> <span class="n">cam</span><span class="p">.</span><span class="n">attach_new_node</span><span class="p">(</span><span class="n">CollisionNode</span><span class="p">(</span><span class="s">&quot;colNode&quot;</span><span class="p">))</span>
<span class="n">fromObject</span><span class="o">-&gt;</span><span class="n">node</span><span class="p">().</span><span class="n">add_solid</span><span class="p">(</span><span class="n">CollisionSphere</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">pusher</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CollisionHandlerPusher</span><span class="p">();</span>
<span class="n">pusher</span><span class="p">.</span><span class="n">add_collider</span><span class="p">(</span><span class="n">fromObject</span><span class="p">,</span><span class="n">cam</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="physicscollisionhandler">
<h2>PhysicsCollisionHandler<a class="headerlink" href="#physicscollisionhandler" title="Permalink to this headline">¶</a></h2>
<p>This kind of handler further specializes CollisionHandlerPusher to integrate
with Panda&#8217;s <a class="reference internal" href="../physics/panda3d-physics-engine/index.html#panda3d-physics-engine"><span class="std std-ref">Physics Engine</span></a>. It requires that
the NodePath you pass as the second parameter to
<code class="docutils literal"><span class="pre">pusher.addCollider</span></code> actually contains an
ActorNode, the type of node that is moved by forces in the physics system.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">anp</span> <span class="o">=</span> <span class="n">render</span><span class="o">.</span><span class="n">attachNewNode</span><span class="p">(</span><span class="n">ActorNode</span><span class="p">(</span><span class="s1">&#39;actor&#39;</span><span class="p">))</span>
<span class="n">fromObject</span> <span class="o">=</span> <span class="n">anp</span><span class="o">.</span><span class="n">attachNewNode</span><span class="p">(</span><span class="n">CollisionNode</span><span class="p">(</span><span class="s1">&#39;colNode&#39;</span><span class="p">))</span>
<span class="n">fromObject</span><span class="o">.</span><span class="n">node</span><span class="p">()</span><span class="o">.</span><span class="n">addSolid</span><span class="p">(</span><span class="n">CollisionSphere</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">pusher</span> <span class="o">=</span> <span class="n">PhysicsCollisionHandler</span><span class="p">()</span>
<span class="n">pusher</span><span class="o">.</span><span class="n">addCollider</span><span class="p">(</span><span class="n">fromObject</span><span class="p">,</span> <span class="n">anp</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">anp</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">get_render</span><span class="p">().</span><span class="n">attach_new_node</span><span class="p">(</span><span class="n">ActorNode</span><span class="p">(</span><span class="s">&quot;actor&quot;</span><span class="p">));</span>
<span class="n">fromObject</span> <span class="o">=</span> <span class="n">anp</span><span class="p">.</span><span class="n">attach_new_node</span><span class="p">(</span><span class="n">CollisionNode</span><span class="p">(</span><span class="s">&quot;codeNode&quot;</span><span class="p">);</span>
<span class="n">fromObject</span><span class="o">-&gt;</span><span class="n">node</span><span class="p">().</span><span class="n">add_solid</span><span class="p">(</span><span class="n">CollisionSphere</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="n">pusher</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PhysicsCollisionHandler</span><span class="p">();</span>
<span class="n">pusher</span><span class="p">.</span><span class="n">add_collider</span><span class="p">(</span><span class="n">fromObject</span> <span class="p">,</span> <span class="n">anp</span><span class="p">);</span>
</pre></div>
</div>
<p>Whenever you have an ActorNode that you want to respond to collisions, we
recommend that you use a PhysicsCollisionHandler rather than an ordinary
CollisionHandlerPusher. The PhysicsCollisionHandler will keep the object out
of walls, just like the CollisionHandlerPusher does, but it will also update
the object&#8217;s velocity within the physics engine, which helps to prevent the
physics system from becoming unstable due to large accumulated velocities.</p>
</div>
<div class="section" id="collisionhandlerfloor">
<h2>CollisionHandlerFloor<a class="headerlink" href="#collisionhandlerfloor" title="Permalink to this headline">¶</a></h2>
<p>This collision handler is designed to serve one very specialized purpose: it
keeps an object on the ground, or falling gently onto the ground, even if the
floor is not level, without involving physics.</p>
<p>It is intended to be used with a
<code class="docutils literal"><span class="pre">CollisionRay</span></code> or
<code class="docutils literal"><span class="pre">CollisionSegment</span></code>. The idea is that you
attach a ray to your object, pointing downward, such that the topmost
intersection the ray detects will be the floor your object should be resting
on. Each frame, the CollisionHandlerFloor simply sets your object&#8217;s z value to
the detected intersection point (or, if it is so configured, it slowly drops
the object towards this point until it reaches it).</p>
<p>Using the CollisionHandlerFloor can be an easy way to simulate an avatar
walking over uneven terrain, without having to set up a complicated physics
simulation (or involve physics in any way). Of course, it does have its
limitations.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">smiley</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">loadModel</span><span class="p">(</span><span class="s1">&#39;smiley.egg&#39;</span><span class="p">)</span>
<span class="n">fromObject</span> <span class="o">=</span> <span class="n">smiley</span><span class="o">.</span><span class="n">attachNewNode</span><span class="p">(</span><span class="n">CollisionNode</span><span class="p">(</span><span class="s1">&#39;colNode&#39;</span><span class="p">))</span>
<span class="n">fromObject</span><span class="o">.</span><span class="n">node</span><span class="p">()</span><span class="o">.</span><span class="n">addSolid</span><span class="p">(</span><span class="n">CollisionRay</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="n">lifter</span> <span class="o">=</span> <span class="n">CollisionHandlerFloor</span><span class="p">()</span>
<span class="n">lifter</span><span class="o">.</span><span class="n">addCollider</span><span class="p">(</span><span class="n">fromObject</span><span class="p">,</span> <span class="n">smiley</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">smiley</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">load_model</span><span class="p">(</span><span class="n">framework</span><span class="p">.</span><span class="n">get_models</span><span class="p">(),</span> <span class="s">&quot;smiley.egg&quot;</span><span class="p">);</span>
<span class="n">fromObject</span> <span class="o">=</span> <span class="n">smiley</span><span class="p">.</span><span class="n">attach_new_node</span><span class="p">(</span><span class="n">CollisionNode</span><span class="p">(</span><span class="s">&quot;colNode&quot;</span><span class="p">));</span>
<span class="n">fromObject</span><span class="o">-&gt;</span><span class="n">node</span><span class="p">().</span><span class="n">add_solid</span><span class="p">(</span><span class="n">CollisionRay</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>

<span class="n">lifter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CollisionHandlerFloor</span><span class="p">();</span>
<span class="n">lifter</span><span class="p">.</span><span class="n">add_collider</span><span class="p">(</span><span class="n">fromObject</span> <span class="p">,</span> <span class="n">smiley</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="collision-entries.html" class="btn btn-neutral float-right" title="Collision Entries" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="collision-solids.html" class="btn btn-neutral" title="Collision Solids" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Panda3D.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.10.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>