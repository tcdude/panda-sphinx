

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Low-Level Render to Texture &mdash; Panda3D Manual</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Panda3D Manual" href="../../index.html"/>
        <link rel="up" title="Render-to-Texture and Image Postprocessing" href="index.html"/>
        <link rel="next" title="Panda3D Rendering Process" href="../panda3d-rendering-process/index.html"/>
        <link rel="prev" title="Dynamic Cube Maps" href="dynamic-cube-maps.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Panda3D
          

          
          </a>

          
            
            
              <div class="version">
                1.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro/index.html">Introduction to Panda3D</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Programming with Panda3D</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../the-scene-graph/index.html">The Scene Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../the-configuration-file/index.html">The Configuration File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../models-and-actors/index.html">Models and Actors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../render-attributes/index.html">Render Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../texturing/index.html">Texturing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shaders/index.html">Shaders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../camera-control/index.html">Camera Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sound/index.html">Sound</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intervals/index.html">Intervals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tasks-and-event-handling/index.html">Tasks and Event Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../text-and-image-rendering/index.html">Text and Image Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../directgui/index.html">DirectGUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../render-effects/index.html">Render Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../finite-state-machines/index.html">Finite State Machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../terrain/index.html">Terrain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internal-structures/index.html">Advanced operations with Panda3D&#8217;s internal structures</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Render-to-Texture and Image Postprocessing</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="common-image-filters.html">Common Image Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="generalized-image-filters.html">Generalized Image Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-cube-maps.html">Dynamic Cube Maps</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Low-Level Render to Texture</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../panda3d-rendering-process/index.html">Panda3D Rendering Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../panda3d-utility-functions.html">Panda3D Utility Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../particle-effects/index.html">Particle Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../collision-detection/index.html">Collision Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../garbage-collection/index.html">Garbage Collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hardware-support/index.html">Hardware support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../math-engine/index.html">Math Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../physics/index.html">Physics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../motion-paths.html">Motion Paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timing/index.html">Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multifiles/index.html">Multifiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../showbase.html">ShowBase</a></li>
<li class="toctree-l2"><a class="reference internal" href="../file-reading.html">File Reading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../threading.html">Threading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subclassing.html">Subclassing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../table-of-features-supported-per-graphic-renderer.html">Table of features supported per graphic renderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pandai/index.html">Artificial Intelligence (PANDAI)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../distribution/index.html">Distributing Panda3D Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../samples/index.html">Sample Programs in the Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance-tuning/index.html">Performance Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../using-c++/index.html">Using C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Panda3D Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../building-from-source.html">Building Panda3D from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cheat-sheets.html">Cheat Sheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started-on-osx.html">Getting Started on OSX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../more-panda3d-resources.html">More Panda3D Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../thirdparty-licenses.html">Third-party dependencies and license info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../the-irc-channel.html">The IRC Channel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Panda3D</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Programming with Panda3D</a> &raquo;</li>
      
          <li><a href="index.html">Render-to-Texture and Image Postprocessing</a> &raquo;</li>
      
    <li>Low-Level Render to Texture</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/programming-with-panda3d/render-to-texture-and-image-postprocessing/low-level-render-to-texture.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="low-level-render-to-texture">
<span id="id1"></span><h1>Low-Level Render to Texture<a class="headerlink" href="#low-level-render-to-texture" title="Permalink to this headline">Â¶</a></h1>
<p>Render to Texture Basics</p>
<p>In Panda3D, rendering to a texture consists of three basic steps:</p>
<ul class="simple">
<li>Create a hidden window (class GraphicsBuffer).</li>
<li>Render into the hidden window.</li>
<li>Transfer the contents of the hidden window into a texture.</li>
</ul>
<p>When I say &#8220;transfer&#8221; the contents of a window into a texture, I don&#8217;t
necessarily mean &#8220;copy.&#8221; There are other ways to transfer the contents of a
window into a texture that may be faster. For example, if the OpenGL
implementation supports the ARB_pbuffers extension, then the transfer might
be achieved using wglBindTexImageARB. The Panda user does not need to worry
about how the transfer is done. It is only important that you know that Panda
will use the fastest means available to transfer the contents of the window
into the texture.</p>
<p>To generalize that a bit, although render-to-texture is usually done with a
hidden window (class GraphicsBuffer), it can also be done with a visible
window (class GraphicsWindow). You can transfer the contents of any window,
hidden or not, into a texture. That&#8217;s potentially useful - for example, you
can transfer the contents of the main window into a texture, which you can
then use when rendering the next frame. This can be used to create
accumulation-buffer-like effects without an accumulation buffer.</p>
<p>The Simple API: makeTextureBuffer</p>
<p>Here is a short snippet of code that creates a hidden window, creates a camera
that renders into that window, and creates a scene graph for that camera:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">mybuffer</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">makeTextureBuffer</span><span class="p">(</span><span class="s2">&quot;My Buffer&quot;</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span class="n">mytexture</span> <span class="o">=</span> <span class="n">mybuffer</span><span class="o">.</span><span class="n">getTexture</span><span class="p">()</span>
<span class="n">mybuffer</span><span class="o">.</span><span class="n">setSort</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
<span class="n">mycamera</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">makeCamera</span><span class="p">(</span><span class="n">mybuffer</span><span class="p">)</span>
<span class="n">myscene</span> <span class="o">=</span> <span class="n">NodePath</span><span class="p">(</span><span class="s2">&quot;My Scene&quot;</span><span class="p">)</span>
<span class="n">mycamera</span><span class="o">.</span><span class="n">reparentTo</span><span class="p">(</span><span class="n">myscene</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="n">PT</span><span class="p">(</span><span class="n">GraphicsOutput</span><span class="p">)</span> <span class="n">mybuffer</span><span class="p">;</span>
<span class="n">PT</span><span class="p">(</span><span class="n">Texture</span><span class="p">)</span> <span class="n">mytexture</span><span class="p">;</span>
<span class="n">PT</span><span class="p">(</span><span class="n">Camera</span><span class="p">)</span> <span class="n">mycamera</span><span class="p">;</span>
<span class="n">PT</span><span class="p">(</span><span class="n">DisplayRegion</span><span class="p">)</span> <span class="n">region</span><span class="p">;</span>
<span class="n">NodePath</span> <span class="n">mycameraNP</span><span class="p">;</span>
<span class="n">NodePath</span> <span class="n">myscene</span><span class="p">;</span>

<span class="n">mybuffer</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">get_graphics_output</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">make_texture_buffer</span><span class="p">(</span><span class="s">&quot;My Buffer&quot;</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">);</span>
<span class="n">mytexture</span> <span class="o">=</span> <span class="n">mybuffer</span><span class="o">-&gt;</span><span class="n">get_texture</span><span class="p">();</span>
<span class="n">mybuffer</span><span class="o">-&gt;</span><span class="n">set_sort</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">);</span>
<span class="n">mycamera</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Camera</span><span class="p">(</span><span class="s">&quot;my camera&quot;</span><span class="p">);</span>
<span class="n">mycameraNP</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">get_render</span><span class="p">().</span><span class="n">attach_new_node</span><span class="p">(</span><span class="n">mycamera</span><span class="p">);</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">mybuffer</span><span class="o">-&gt;</span><span class="n">make_display_region</span><span class="p">();</span>
<span class="n">region</span><span class="o">-&gt;</span><span class="n">set_camera</span><span class="p">(</span><span class="n">mycameraNP</span><span class="p">);</span>
<span class="n">myscene</span> <span class="o">=</span> <span class="n">NodePath</span><span class="p">(</span><span class="s">&quot;My Scene&quot;</span><span class="p">);</span>
<span class="n">mycameraNP</span><span class="p">.</span><span class="n">reparent_to</span><span class="p">(</span><span class="n">myscene</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">makeTextureBuffer</span></code> is the simple
interface to the render-to-texture functionality. It creates a new hidden
window (usually a GraphicsBuffer), creates a texture to render into, and
connects the texture to the hidden window. The (512, 512) in the function call
specifies the size of the hidden window and texture. Of course, you need to
use a power-of-two size. The
<code class="docutils literal"><span class="pre">getTexture</span></code> method retrieves the
texture, which will be rendered into every frame.</p>
<p>The <code class="docutils literal"><span class="pre">setSort</span></code> method sets a
window&#8217;s sort order. This controls the order in which panda renders the
various windows. The main window&#8217;s sort order is zero. By setting the sort
order of mybuffer to a negative number, we ensure that mybuffer will be
rendered first. That, in turn, ensures that mytexture will be ready to use by
the time that the main window is rendered.</p>
<p>The new hidden window is not automatically connected to the scene graph. In
this example, we create a separate scene graph rooted at myscene, create a
camera to view that scene graph, and connect the camera to mybuffer.</p>
<p>The function <code class="docutils literal"><span class="pre">makeTextureBuffer</span></code> usually
creates a GraphicsBuffer (hidden window), but if the video card is not
powerful enough to create an offscreen window, it may not be able to do so. In
that case, <code class="docutils literal"><span class="pre">makeTextureBuffer</span></code> will create
a <code class="docutils literal"><span class="pre">parasiteBuffer</span></code> instead. A parasite
buffer is primarily a trick to emulate a GraphicsBuffer on video cards that
are less powerful. The trick is this: instead of rendering to an offscreen
window and then transferring the data into a texture, panda renders into the
main window and then copies the data into the texture. The limitations of this
trick are self-evident. First, it garbles the contents of the main window.
This is usually no big deal, since the main window is usually cleared and
rendered from scratch every frame anyway. The other problem with this trick is
that it fails if the main window is smaller than the desired texture. Since
neither of these problems is common in practice,
<code class="docutils literal"><span class="pre">makeTextureBuffer</span></code> will use parasite
buffers transparently if GraphicsBuffers are not available.</p>
<p>There is a debugging mode in which
<code class="docutils literal"><span class="pre">makeTextureBuffer</span></code> will create a visible
window (class GraphicsWindow) instead of a hidden one (class GraphicsBuffer).
To enable this debugging mode, set the boolean variable &#8220;show-buffers #t&#8221; in
your panda configuration file.</p>
<p>The Advanced API: addRenderTexture</p>
<p>The simple API is convenient, but there are a few things it can not do. For
instance, it can not:</p>
<ul class="simple">
<li>Copy the main window into a texture.</li>
<li>Copy the Z-buffer into a depth texture.</li>
<li>Copy the window into a texture, but not every frame.</li>
<li>Limit or force the use of Parasite buffers.</li>
</ul>
<p>If you need this level of control, you need to use a lower-level API. The
low-level function that is called for the creation of all buffers and windows
is makeOutput on the GraphicsEngine class.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">fb_prop</span> <span class="o">=</span> <span class="n">FrameBufferProperties</span><span class="p">()</span>
<span class="c1"># Request 8 RGB bits, no alpha bits, and a depth buffer.</span>
<span class="n">fb_prop</span><span class="o">.</span><span class="n">setRgbColor</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">fb_prop</span><span class="o">.</span><span class="n">setRgbaBits</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">fb_prop</span><span class="o">.</span><span class="n">setDepthBits</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Create a WindowProperties object set to 512x512 size.</span>
<span class="n">win_prop</span> <span class="o">=</span> <span class="n">WindowProperties</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>

<span class="c1"># Don&#39;t open a window - force it to be an offscreen buffer.</span>
<span class="n">flags</span> <span class="o">=</span> <span class="n">GraphicsPipe</span><span class="o">.</span><span class="n">BF_refuse_window</span>

<span class="n">base</span><span class="o">.</span><span class="n">graphicsEngine</span><span class="o">.</span><span class="n">make_output</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">pipe</span><span class="p">,</span> <span class="s2">&quot;My Buffer&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="n">fb_prop</span><span class="p">,</span> <span class="n">win_prop</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">win</span><span class="o">.</span><span class="n">getGsg</span><span class="p">(),</span> <span class="n">base</span><span class="o">.</span><span class="n">win</span><span class="p">)</span>
</pre></div>
</div>
<p>The method takes a FrameBufferProperties object describing the requested
amount of bits that are available in GPU memory, as well as a WindowProperties
object describing the properties of the window to be opened. In the case of an
offscreen buffer, which is acquired by passing BF_refuse_window as a flag,
only the size setting of the WindowProperties object is used.</p>
<p>Offscreen buffers may require passing in a host window and a host GSG, since
the graphics API may require an existing graphics context in order to create
an offscreen buffer. When creating a window, the last two parameters may be
omitted.</p>
<p>For the meaning of the various flags, consult the GraphicsPipe API
documentation.</p>
<p>Several of the <a class="reference internal" href="../../samples/index.html#samples"><span class="std std-ref">Sample Programs</span></a> use the lower-level API.</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../panda3d-rendering-process/index.html" class="btn btn-neutral float-right" title="Panda3D Rendering Process" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dynamic-cube-maps.html" class="btn btn-neutral" title="Dynamic Cube Maps" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Panda3D.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.10.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>