

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Simulating the Physics World &mdash; Panda3D Manual</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="Panda3D Manual" href="../../../index.html"/>
        <link rel="up" title="Using ODE with Panda3D" href="index.html"/>
        <link rel="next" title="Attaching Bodies using Joints" href="attaching-bodies-using-joints.html"/>
        <link rel="prev" title="Worlds, Bodies and Masses" href="worlds-bodies-and-masses.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Panda3D
          

          
          </a>

          
            
            
              <div class="version">
                1.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../intro/index.html">Introduction to Panda3D</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Programming with Panda3D</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../the-scene-graph/index.html">The Scene Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../the-configuration-file/index.html">The Configuration File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models-and-actors/index.html">Models and Actors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../render-attributes/index.html">Render Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../texturing/index.html">Texturing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../shaders/index.html">Shaders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../camera-control/index.html">Camera Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sound/index.html">Sound</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../intervals/index.html">Intervals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tasks-and-event-handling/index.html">Tasks and Event Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../text-and-image-rendering/index.html">Text and Image Rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../directgui/index.html">DirectGUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../render-effects/index.html">Render Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../finite-state-machines/index.html">Finite State Machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../terrain/index.html">Terrain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal-structures/index.html">Advanced operations with Panda3D&#8217;s internal structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../render-to-texture-and-image-postprocessing/index.html">Render-to-Texture and Image Postprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../panda3d-rendering-process/index.html">Panda3D Rendering Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../panda3d-utility-functions.html">Panda3D Utility Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../particle-effects/index.html">Particle Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collision-detection/index.html">Collision Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../garbage-collection/index.html">Garbage Collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hardware-support/index.html">Hardware support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../math-engine/index.html">Math Engine</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Physics</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../panda3d-physics-engine/index.html">Panda3D Physics Engine</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Using ODE with Panda3D</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="worlds-bodies-and-masses.html">Worlds, Bodies and Masses</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Simulating the Physics World</a></li>
<li class="toctree-l4"><a class="reference internal" href="attaching-bodies-using-joints.html">Attaching Bodies using Joints</a></li>
<li class="toctree-l4"><a class="reference internal" href="collision-detection-with-ode.html">Collision Detection with ODE</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../bullet/index.html">Using Bullet with Panda3D</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../motion-paths.html">Motion Paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timing/index.html">Timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../networking/index.html">Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../multifiles/index.html">Multifiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../showbase.html">ShowBase</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../file-reading.html">File Reading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../threading.html">Threading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../subclassing.html">Subclassing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../table-of-features-supported-per-graphic-renderer.html">Table of features supported per graphic renderer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pandai/index.html">Artificial Intelligence (PANDAI)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../distribution/index.html">Distributing Panda3D Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples/index.html">Sample Programs in the Distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../debugging/index.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../performance-tuning/index.html">Performance Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../using-c++/index.html">Using C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Panda3D Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../building-from-source.html">Building Panda3D from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cheat-sheets.html">Cheat Sheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started-on-osx.html">Getting Started on OSX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../more-panda3d-resources.html">More Panda3D Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../thirdparty-licenses.html">Third-party dependencies and license info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../the-irc-channel.html">The IRC Channel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">FAQ</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Panda3D</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Programming with Panda3D</a> &raquo;</li>
      
          <li><a href="../index.html">Physics</a> &raquo;</li>
      
          <li><a href="index.html">Using ODE with Panda3D</a> &raquo;</li>
      
    <li>Simulating the Physics World</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../_sources/programming-with-panda3d/physics/ode/simulating-the-physics-world.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="simulating-the-physics-world">
<span id="id1"></span><h1>Simulating the Physics World<a class="headerlink" href="#simulating-the-physics-world" title="Permalink to this headline">¶</a></h1>
<div class="section" id="simulating-the-physics-scene">
<h2>Simulating the physics scene<a class="headerlink" href="#simulating-the-physics-scene" title="Permalink to this headline">¶</a></h2>
<p>Now, we&#8217;ve only had some theory so far, but haven&#8217;t seen any simulation yet.
To simulate, we will need to keep calling the
<code class="docutils literal"><span class="pre">quickStep(stepSize)</span></code> function on the
OdeWorld instance. stepSize is how much time should be simulated in one step.
To get the most stable simulation, it is recommended that the stepSize be kept
constant.</p>
<p>The problem with using the delta time of a task to step the simulation is that
the time between tasks might not be consistent. To get around this, a
deltaTime accumulator is used to figure out how many steps must be taken. When
a step is performed, the world is iterated a few times, you can specify how
much times the world is being iterated by calling the
<code class="docutils literal"><span class="pre">setQuickStepNumIterations(num)</span></code> function on the
OdeWorld instance.</p>
<p>Here&#8217;s a small example showing a simple simulation showing an iron ball
falling from a ridge:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">direct.directbase</span> <span class="kn">import</span> <span class="n">DirectStart</span>
<span class="kn">from</span> <span class="nn">panda3d.ode</span> <span class="kn">import</span> <span class="n">OdeWorld</span><span class="p">,</span> <span class="n">OdeBody</span><span class="p">,</span> <span class="n">OdeMass</span>
<span class="kn">from</span> <span class="nn">panda3d.core</span> <span class="kn">import</span> <span class="n">Quat</span>

<span class="c1"># Load the cube where the ball will fall from</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">loadModel</span><span class="p">(</span><span class="s2">&quot;box.egg&quot;</span><span class="p">)</span>
<span class="n">cube</span><span class="o">.</span><span class="n">reparentTo</span><span class="p">(</span><span class="n">render</span><span class="p">)</span>
<span class="n">cube</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">)</span>
<span class="n">cube</span><span class="o">.</span><span class="n">setScale</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Load the smiley model which will act as our iron ball</span>
<span class="n">sphere</span> <span class="o">=</span> <span class="n">loader</span><span class="o">.</span><span class="n">loadModel</span><span class="p">(</span><span class="s2">&quot;smiley.egg&quot;</span><span class="p">)</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">reparentTo</span><span class="p">(</span><span class="n">render</span><span class="p">)</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">sphere</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>

<span class="c1"># Setup our physics world and the body</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">OdeWorld</span><span class="p">()</span>
<span class="n">world</span><span class="o">.</span><span class="n">setGravity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">)</span>
<span class="n">body</span> <span class="o">=</span> <span class="n">OdeBody</span><span class="p">(</span><span class="n">world</span><span class="p">)</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">OdeMass</span><span class="p">()</span>
<span class="n">M</span><span class="o">.</span><span class="n">setSphere</span><span class="p">(</span><span class="mi">7874</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">body</span><span class="o">.</span><span class="n">setMass</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<span class="n">body</span><span class="o">.</span><span class="n">setPosition</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">getPos</span><span class="p">(</span><span class="n">render</span><span class="p">))</span>
<span class="n">body</span><span class="o">.</span><span class="n">setQuaternion</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">getQuat</span><span class="p">(</span><span class="n">render</span><span class="p">))</span>

<span class="c1"># Set the camera position</span>
<span class="n">base</span><span class="o">.</span><span class="n">disableMouse</span><span class="p">()</span>
<span class="n">base</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="n">base</span><span class="o">.</span><span class="n">camera</span><span class="o">.</span><span class="n">lookAt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1"># Create an accumulator to track the time since the sim</span>
<span class="c1"># has been running</span>
<span class="n">deltaTimeAccumulator</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="c1"># This stepSize makes the simulation run at 90 frames per second</span>
<span class="n">stepSize</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">90.0</span>

<span class="c1"># The task for our simulation</span>
<span class="k">def</span> <span class="nf">simulationTask</span><span class="p">(</span><span class="n">task</span><span class="p">):</span>
  <span class="k">global</span> <span class="n">deltaTimeAccumulator</span>
  <span class="c1"># Set the force on the body to push it off the ridge</span>
  <span class="n">body</span><span class="o">.</span><span class="n">setForce</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">time</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">500000</span> <span class="o">-</span> <span class="mi">500000</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
  <span class="c1"># Add the deltaTime for the task to the accumulator</span>
  <span class="n">deltaTimeAccumulator</span> <span class="o">+=</span> <span class="n">globalClock</span><span class="o">.</span><span class="n">getDt</span><span class="p">()</span>
  <span class="k">while</span> <span class="n">deltaTimeAccumulator</span> <span class="o">&gt;</span> <span class="n">stepSize</span><span class="p">:</span>
    <span class="c1"># Remove a stepSize from the accumulator until</span>
    <span class="c1"># the accumulated time is less than the stepsize</span>
    <span class="n">deltaTimeAccumulator</span> <span class="o">-=</span> <span class="n">stepSize</span>
    <span class="c1"># Step the simulation</span>
    <span class="n">world</span><span class="o">.</span><span class="n">quickStep</span><span class="p">(</span><span class="n">stepSize</span><span class="p">)</span>
  <span class="c1"># set the new positions</span>
  <span class="n">sphere</span><span class="o">.</span><span class="n">setPosQuat</span><span class="p">(</span><span class="n">render</span><span class="p">,</span> <span class="n">body</span><span class="o">.</span><span class="n">getPosition</span><span class="p">(),</span> <span class="n">Quat</span><span class="p">(</span><span class="n">body</span><span class="o">.</span><span class="n">getQuaternion</span><span class="p">()))</span>
  <span class="k">return</span> <span class="n">task</span><span class="o">.</span><span class="n">cont</span>

<span class="n">taskMgr</span><span class="o">.</span><span class="n">doMethodLater</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">simulationTask</span><span class="p">,</span> <span class="s2">&quot;Physics Simulation&quot;</span><span class="p">)</span>

<span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-cpp"><div class="highlight"><pre><span></span><span class="c1">// To keep the C++ samples short, we assume a running Panda</span>
<span class="c1">// environment, with a &quot;framework&quot;, &quot;window&quot;, &quot;camera&quot; and &quot;taskMgr&quot; variables</span>
<span class="c1">// in the global scope. Likewise, only the includes relevant to this chapter</span>
<span class="c1">// are shown. Check the beginning of the manual for a tutorial on making a</span>
<span class="c1">// full Panda3D C++ app.</span>
<span class="c1">// Sample entry point: simulation()</span>

<span class="cp">#include</span> <span class="cpf">&quot;odeWorld.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;odeBody.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;odeMass.h&quot;</span><span class="cp"></span>

<span class="n">OdeBody</span> <span class="o">*</span><span class="n">body</span><span class="p">;</span>
<span class="n">OdeWorld</span> <span class="n">world</span><span class="p">;</span>
<span class="n">NodePath</span> <span class="n">sphere</span><span class="p">;</span>
<span class="n">PT</span><span class="p">(</span><span class="n">ClockObject</span><span class="p">)</span> <span class="n">globalClock</span> <span class="o">=</span> <span class="n">ClockObject</span><span class="o">::</span><span class="n">get_global_clock</span><span class="p">();</span>

<span class="c1">// Create an accumulator to track the time since the sim</span>
<span class="c1">// has been running</span>
<span class="kt">float</span> <span class="n">deltaTimeAccumulator</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>

<span class="c1">// This stepSize makes the simulation run at 90 frames per second</span>
<span class="kt">float</span> <span class="n">stepSize</span> <span class="o">=</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="mf">90.0f</span><span class="p">;</span>

<span class="n">AsyncTask</span><span class="o">::</span><span class="n">DoneStatus</span> <span class="n">simulationTask</span> <span class="p">(</span><span class="n">GenericAsyncTask</span><span class="o">*</span> <span class="n">task</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">simulation</span><span class="p">(){</span>
  <span class="c1">// Load the cube where the ball will fall from</span>
  <span class="n">NodePath</span> <span class="n">cube</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">load_model</span><span class="p">(</span><span class="n">framework</span><span class="p">.</span><span class="n">get_models</span><span class="p">(),</span> <span class="s">&quot;models/box&quot;</span><span class="p">);</span>
  <span class="n">cube</span><span class="p">.</span><span class="n">reparent_to</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">get_render</span><span class="p">());</span>
  <span class="n">cube</span><span class="p">.</span><span class="n">set_scale</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">);</span>
  <span class="n">cube</span><span class="p">.</span><span class="n">set_pos</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

  <span class="c1">// Load the smiley model which will act as our iron ball</span>
  <span class="n">sphere</span> <span class="o">=</span> <span class="n">window</span><span class="o">-&gt;</span><span class="n">load_model</span><span class="p">(</span><span class="n">framework</span><span class="p">.</span><span class="n">get_models</span><span class="p">(),</span> <span class="s">&quot;models/smiley&quot;</span><span class="p">);</span>
  <span class="n">sphere</span><span class="p">.</span><span class="n">reparent_to</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">get_render</span><span class="p">());</span>
  <span class="n">sphere</span><span class="p">.</span><span class="n">set_scale</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">);</span>
  <span class="n">sphere</span><span class="p">.</span><span class="n">set_pos</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

  <span class="c1">// Setup our physics world and the body</span>
  <span class="n">world</span><span class="p">.</span><span class="n">set_gravity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.81</span><span class="p">);</span>
  <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OdeBody</span><span class="p">(</span><span class="n">world</span><span class="p">);</span>
  <span class="n">OdeMass</span> <span class="n">M</span> <span class="o">=</span> <span class="n">OdeMass</span><span class="p">();</span>
  <span class="n">M</span><span class="p">.</span><span class="n">set_sphere</span><span class="p">(</span><span class="mi">7874</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
  <span class="n">body</span><span class="o">-&gt;</span><span class="n">set_mass</span><span class="p">(</span><span class="n">M</span><span class="p">);</span>
  <span class="n">body</span><span class="o">-&gt;</span><span class="n">set_position</span><span class="p">(</span><span class="n">sphere</span><span class="p">.</span><span class="n">get_pos</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">get_render</span><span class="p">()));</span>
  <span class="n">body</span><span class="o">-&gt;</span><span class="n">set_quaternion</span><span class="p">(</span><span class="n">sphere</span><span class="p">.</span><span class="n">get_quat</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">get_render</span><span class="p">()));</span>

  <span class="c1">// Set the camera position</span>
  <span class="n">camera</span><span class="p">.</span><span class="n">set_pos</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
  <span class="n">camera</span><span class="p">.</span><span class="n">look_at</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

  <span class="n">PT</span><span class="p">(</span><span class="n">GenericAsyncTask</span><span class="p">)</span> <span class="n">simulationTaskObject</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">GenericAsyncTask</span><span class="p">(</span><span class="s">&quot;startup task&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">simulationTask</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="n">simulationTaskObject</span><span class="o">-&gt;</span><span class="n">set_delay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="n">taskMgr</span><span class="o">-&gt;</span><span class="n">add</span><span class="p">(</span><span class="n">simulationTaskObject</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// The task for our simulation</span>
<span class="n">AsyncTask</span><span class="o">::</span><span class="n">DoneStatus</span> <span class="n">simulationTask</span> <span class="p">(</span><span class="n">GenericAsyncTask</span><span class="o">*</span> <span class="n">task</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Set the force on the body to push it off the ridge</span>
  <span class="n">body</span><span class="o">-&gt;</span><span class="n">set_force</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">min</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">get_elapsed_time</span><span class="p">(),</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">500000</span> <span class="o">-</span> <span class="mi">500000</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
  <span class="c1">// Add the deltaTime for the task to the accumulator</span>
  <span class="n">deltaTimeAccumulator</span> <span class="o">+=</span> <span class="n">globalClock</span><span class="o">-&gt;</span><span class="n">get_dt</span><span class="p">();</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">deltaTimeAccumulator</span> <span class="o">&gt;</span> <span class="n">stepSize</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Remove a stepSize from the accumulator until</span>
    <span class="c1">// the accumulated time is less than the stepsize</span>
    <span class="n">deltaTimeAccumulator</span> <span class="o">-=</span> <span class="n">stepSize</span><span class="p">;</span>
    <span class="c1">// Step the simulation</span>
    <span class="n">world</span><span class="p">.</span><span class="n">quick_step</span><span class="p">(</span><span class="n">stepSize</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// set the new positions</span>
  <span class="n">sphere</span><span class="p">.</span><span class="n">set_pos_quat</span><span class="p">(</span><span class="n">window</span><span class="o">-&gt;</span><span class="n">get_render</span><span class="p">(),</span>
    <span class="n">body</span><span class="o">-&gt;</span><span class="n">get_position</span><span class="p">(),</span> <span class="n">body</span><span class="o">-&gt;</span><span class="n">get_quaternion</span><span class="p">());</span>
  <span class="k">return</span> <span class="n">AsyncTask</span><span class="o">::</span><span class="n">DS_cont</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="incomplete-section">
<h2>Incomplete Section<a class="headerlink" href="#incomplete-section" title="Permalink to this headline">¶</a></h2>
<p>Note: this section is incomplete. It will be updated soon.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="attaching-bodies-using-joints.html" class="btn btn-neutral float-right" title="Attaching Bodies using Joints" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="worlds-bodies-and-masses.html" class="btn btn-neutral" title="Worlds, Bodies and Masses" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Panda3D.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.10.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>